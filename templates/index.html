<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ChatGPT Duck Control</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="container">
        <div class="duck-emoji">ğŸ¦†</div>
        <h1>ChatGPT Duck</h1>
        
        <!-- Current User Display -->
        <div id="current-user" style="text-align: center; margin: 15px 0; padding: 10px; background: #f0f0f0; border-radius: 8px; font-size: 1.1em;">
            <span style="color: #666;">ğŸ‘¤ NÃ¥vÃ¦rende bruker:</span> 
            <span id="user-name" style="font-weight: bold; color: #667eea;">...</span>
            <span id="user-relation" style="color: #888; font-size: 0.9em;"></span>
        </div>
        
        <div id="status" class="status-box status-unknown">
            Henter status...
        </div>
        
        <!-- Home Assistant Status -->
        <div id="ha-status" style="text-align: center; margin: 10px 0; padding: 8px; background: #f8f9fa; border-radius: 8px; font-size: 0.95em; border: 1px solid #ddd;">
            <span style="color: #666;">ğŸ  Home Assistant:</span> 
            <span id="ha-status-text" style="font-weight: bold;">...</span>
        </div>
        
        <!-- Control Panel Section -->
        <div class="collapsible">
            <div class="collapsible-header" onclick="toggleCollapsible(this)">
                <span>ğŸ›ï¸ Kontrollpanel</span>
                <span class="arrow">â–¼</span>
            </div>
            <div class="collapsible-content">
                <div class="collapsible-body">
                    <button class="btn-start" onclick="controlDuck('start')">â–¶ï¸ Start Duck</button>
                    <button class="btn-stop" onclick="controlDuck('stop')">â¹ï¸ Stopp Duck</button>
                    <button class="btn-restart" onclick="controlDuck('restart')">ğŸ”„ Restart Duck</button>
                    <button class="btn-user" onclick="toggleUserPanel()">ğŸ‘¥ Bytt Bruker</button>
                    <button class="btn-logs" onclick="toggleLogs()">ğŸ“‹ Vis Logger</button>
                    <button class="btn-wifi" onclick="switchToHotspot()">ğŸ“¡ Bytt WiFi-nettverk</button>
                    <button class="btn-reboot" onclick="rebootPi()">ğŸ”„ Restart Pi</button>
                    <button class="btn-shutdown" onclick="shutdownPi()">ğŸ”Œ Skru av Pi</button>
                </div>
            </div>
        </div>
        
        <div id="log-output" style="display: none; margin: 20px 0; padding: 20px; background: #1e1e1e; border-radius: 10px; box-shadow: 0 4px 6px rgba(0,0,0,0.3); border: 1px solid #333; max-height: 400px; overflow-y: auto;">
            <div id="log-content" style="font-family: 'Courier New', monospace; font-size: 12px; color: #00ff00; line-height: 1.4; white-space: pre-wrap; word-break: break-all;">
                Laster logger...
            </div>
        </div>
        
        <!-- User Management Panel -->
        <div id="user-panel" style="display: none; margin: 20px 0; padding: 20px; background: #f8f9fa; border-radius: 10px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); border: 2px solid #667eea;">
            <h3 style="margin-top: 0; color: #667eea;">ğŸ‘¥ Brukeradministrasjon</h3>
            
            <div style="margin: 15px 0;">
                <label style="display: block; margin-bottom: 5px; font-weight: bold;">Bytt til eksisterende bruker:</label>
                <select id="user-select" style="width: 100%; padding: 10px; border-radius: 5px; border: 1px solid #ddd; font-size: 1em;">
                    <option value="">Laster brukere...</option>
                </select>
                <button onclick="switchToUser()" style="width: 100%; margin-top: 10px; padding: 12px; background: #667eea; color: white; border: none; border-radius: 5px; cursor: pointer; font-size: 1em; font-weight: bold;">
                    ğŸ”„ Bytt bruker
                </button>
            </div>
            
            <div style="margin: 20px 0; padding-top: 20px; border-top: 2px solid #ddd;">
                <h4 style="margin-top: 0;">ğŸ“‹ Registrerte brukere:</h4>
                <div id="users-list" style="max-height: 200px; overflow-y: auto;">
                    Laster brukere...
                </div>
            </div>
        </div>
        
        <!-- Grunninnstillinger -->
        <div class="collapsible">
            <div class="collapsible-header" onclick="toggleCollapsible(this)">
                <span>ğŸ›ï¸ Grunninnstillinger</span>
                <span class="arrow">â–¼</span>
            </div>
            <div class="collapsible-content">
                <div class="collapsible-body">
                    <div class="speak-section">
                        <h3>ğŸ¤– AI Modell</h3>
                        <select id="model-select" onchange="changeModel()">
                            <option value="gpt-4-turbo-2024-04-09">GPT-4.1 Mini â­ (Anbefalt)</option>
                            <option value="gpt-4">GPT-4</option>
                            <option value="gpt-4-turbo">GPT-4.1 Turbo</option>
                            <option value="gpt-4o-mini">GPT-4o Mini (Billig)</option>
                            <option value="gpt-3.5-turbo">GPT-3.5 Turbo</option>
                            <option value="gpt-5-turbo">GPT-5.2</option>
                        </select>
                        <span id="model-status"></span>
                        <div style="font-size: 11px; color: #666; margin-top: 5px;">
                            Rediger AVAILABLE_MODELS i duck_config.py for Ã¥ endre tilgjengelige modeller
                        </div>
                    </div>
                    
                    <div class="speak-section">
                        <h3>ğŸ­ Personlighet</h3>
                        <select id="personality-select" onchange="changePersonality()">
                            <option value="normal">Normal ğŸ¦†</option>
                            <option value="frekk">Frekk & Sarkastisk ğŸ˜</option>
                            <option value="vennlig">Vennlig & Entusiastisk ğŸ˜Š</option>
                            <option value="akademisk">Akademisk & Detaljert ğŸ“</option>
                            <option value="filosof">Filosofisk & Reflekterende ğŸ¤”</option>
                            <option value="barnlig">Barnlig & Leken ğŸ‰</option>
                            <option value="senior">Senior & Sur ğŸ‘´</option>
                        </select>
                        <span id="personality-status"></span>
                    </div>
                    
                    <div class="speak-section">
                        <h3>ğŸ¤ Stemme</h3>
                        <select id="voice-select" onchange="changeVoice()">
                            <option value="nb-NO-FinnNeural">Finn (Mann) ğŸ‘¨</option>
                            <option value="nb-NO-IselinNeural">Iselin (Kvinne) ğŸ‘©</option>
                        </select>
                        <span id="voice-status"></span>
                    </div>
                    
                    <div class="speak-section">
                        <h3>ğŸ¦† Nebbet</h3>
                        <select id="beak-select" onchange="changeBeak()">
                            <option value="on">Nebbet beveger seg ğŸ‘„</option>
                            <option value="off">Nebbet av ğŸ”‡</option>
                        </select>
                        <span id="beak-status"></span>
                    </div>
                    
                    <div class="speak-section">
                        <h3>ğŸšï¸ Talehastighet</h3>
                        <div style="display: flex; align-items: center; gap: 10px;">
                            <span>ğŸŒ Sakte</span>
                            <input type="range" id="speed-slider" min="0" max="100" value="50" 
                                   oninput="updateSpeedLabel()" onchange="changeSpeed()" 
                                   style="flex: 1;">
                            <span>ğŸ‡ Raskt</span>
                        </div>
                        <div style="text-align: center; margin-top: 10px; font-weight: bold;" id="speed-label">Normal hastighet</div>
                        <span id="speed-status"></span>
                    </div>
                    
                    <div class="speak-section">
                        <h3>ğŸ”Š Volum</h3>
                        <div style="display: flex; align-items: center; gap: 10px;">
                            <span>ğŸ”‰ Lavt</span>
                            <input type="range" id="volume-slider" min="0" max="100" value="50" 
                                   oninput="updateVolumeValue()" onchange="changeVolume()" 
                                   style="flex: 1;">
                            <span>ğŸ”Š HÃ¸yt</span>
                        </div>
                        <div style="text-align: center; margin-top: 10px;">
                            <span id="volume-value" style="font-weight: bold;">50%</span>
                            <span id="volume-status"></span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Kommunikasjon -->
        <div class="collapsible">
            <div class="collapsible-header" onclick="toggleCollapsible(this)">
                <span>ğŸ’¬ Kommunikasjon</span>
                <span class="arrow">â–¼</span>
            </div>
            <div class="collapsible-content">
                <div class="collapsible-body">
                    <div class="speak-section">
                        <h3>ğŸ™ï¸ Wake Words</h3>
                        <div id="wake-words-list" class="info" style="background: #e8f5e9; border-left-color: #4caf50;">
                            <p style="margin: 0; color: #2e7d32;">Laster wake words...</p>
                        </div>
                    </div>
        
        <div class="speak-section">
            <h3>ğŸ¦†ğŸ’¬ Start samtale</h3>
            <button class="btn-start" onclick="startConversation()">ğŸ¤ Start samtale nÃ¥</button>
        </div>
        
        <div class="speak-section" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); padding: 25px; border-radius: 15px; box-shadow: 0 8px 16px rgba(0,0,0,0.2);">
            <h3 style="color: white; margin-bottom: 20px; font-size: 20px;">ï¿½ Send melding til anda</h3>
            <div style="margin-bottom: 15px;">
                <label style="color: white; font-weight: bold; display: block; margin-bottom: 8px;">Velg modus:</label>
                <select id="message-mode" style="width: 100%; padding: 12px; border-radius: 8px; border: 2px solid white; font-size: 16px; background: white; cursor: pointer; box-sizing: border-box;">
                    <option value="speak">ğŸ”Š Bare si det (TTS)</option>
                    <option value="ai">ğŸ¤– Send til AI (ChatGPT)</option>
                </select>
            </div>
            <textarea id="speak-text" rows="6" placeholder="Skriv din melding her..." style="width: 100%; padding: 15px; border-radius: 10px; border: 2px solid white; font-size: 16px; resize: vertical; min-height: 120px; font-family: Arial, sans-serif; box-sizing: border-box;"></textarea>
            <button class="btn-send" onclick="sendMessage()" style="width: 100%; margin-top: 15px; padding: 15px; font-size: 18px; font-weight: bold; background: white; color: #667eea; border: none; border-radius: 10px; cursor: pointer; transition: all 0.3s; box-sizing: border-box;" onmouseover="this.style.background='#f0f0f0'; this.style.transform='scale(1.02)'" onmouseout="this.style.background='white'; this.style.transform='scale(1)'">ğŸ“¤ Send melding</button>
                        <div id="ai-response" style="margin-top: 20px; padding: 20px; background-color: rgba(255,255,255,0.95); border-radius: 10px; display: none; box-shadow: 0 4px 8px rgba(0,0,0,0.1);">
                            <strong style="color: #667eea; font-size: 16px;">ğŸ¤– AI Svar:</strong>
                            <div id="response-text" style="margin-top: 10px; color: #333; line-height: 1.6;"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Musikk -->
        <div class="collapsible">
            <div class="collapsible-header" onclick="toggleCollapsible(this)">
                <span>ğŸµ Musikk</span>
                <span class="arrow">â–¼</span>
            </div>
            <div class="collapsible-content">
                <div class="collapsible-body">
                    <div class="speak-section" style="background: linear-gradient(135deg, #e91e63 0%, #9c27b0 100%); padding: 25px; border-radius: 15px; box-shadow: 0 8px 16px rgba(0,0,0,0.2);">
                        <h3 style="color: white; margin-bottom: 20px; font-size: 20px;">ğŸµ La anda synge!</h3>
                        <select id="song-select" style="width: 100%; padding: 12px; border-radius: 8px; border: 2px solid white; font-size: 16px; background: white; margin-bottom: 15px; box-sizing: border-box;">
                            <option value="">Velg en sang...</option>
                        </select>
                        <button class="btn-start" onclick="playSong()" style="width: 100%; margin-bottom: 10px; padding: 15px; font-size: 18px; font-weight: bold; background: white; color: #e91e63; border: none; border-radius: 10px; cursor: pointer; transition: all 0.3s; box-sizing: border-box;" onmouseover="this.style.background='#f0f0f0'; this.style.transform='scale(1.02)'" onmouseout="this.style.background='white'; this.style.transform='scale(1)'">ğŸ¤ Syng!</button>
                        <button class="btn-stop" onclick="stopSong()" style="width: 100%; padding: 15px; font-size: 18px; font-weight: bold; background: rgba(255,255,255,0.2); color: white; border: 2px solid white; border-radius: 10px; cursor: pointer; transition: all 0.3s; box-sizing: border-box;" onmouseover="this.style.background='rgba(255,255,255,0.3)'; this.style.transform='scale(1.02)'" onmouseout="this.style.background='rgba(255,255,255,0.2)'; this.style.transform='scale(1)'">â¹ Stopp syng</button>
                        <div id="song-status" style="margin-top: 15px; padding: 15px; background: rgba(255,255,255,0.9); border-radius: 8px; display: none; color: #333;"></div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Minne -->
        <div class="collapsible">
            <div class="collapsible-header" onclick="toggleCollapsible(this)">
                <span>ğŸ§  Andas Minne</span>
                <span class="arrow">â–¼</span>
            </div>
            <div class="collapsible-content">
                <div class="collapsible-body">
                    <div class="speak-section" style="background: linear-gradient(135deg, #00bcd4 0%, #009688 100%); padding: 25px; border-radius: 15px; box-shadow: 0 8px 16px rgba(0,0,0,0.2);">
                        <h3 style="color: white; margin-bottom: 20px; font-size: 20px;">ğŸ§  Andas Minne</h3>
                        
                        <!-- Quick Facts -->
                        <div id="quick-facts" style="background: rgba(255,255,255,0.95); border-radius: 10px; padding: 15px; margin-bottom: 15px;">
                            <h4 style="margin: 0 0 10px 0; color: #00bcd4;">âš¡ NÃ¸kkelfakta</h4>
                            <div id="quick-facts-content" style="font-size: 14px; color: #333;">
                                <p style="margin: 5px 0;">Laster...</p>
                            </div>
                        </div>
                        
                        <!-- Memory Stats -->
                        <div style="background: rgba(255,255,255,0.95); border-radius: 10px; padding: 15px; margin-bottom: 15px;">
                            <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                                <div style="text-align: center; flex: 1;">
                                    <div style="font-size: 24px; font-weight: bold; color: #00bcd4;" id="memory-stats-facts">-</div>
                                    <div style="font-size: 12px; color: #666;">Fakta</div>
                                </div>
                                <div style="text-align: center; flex: 1;">
                                    <div style="font-size: 24px; font-weight: bold; color: #009688;" id="memory-stats-memories">-</div>
                                    <div style="font-size: 12px; color: #666;">Minner</div>
                                </div>
                                <div style="text-align: center; flex: 1;">
                                    <div style="font-size: 24px; font-weight: bold; color: #4caf50;" id="memory-stats-messages">-</div>
                                    <div style="font-size: 12px; color: #666;">Meldinger</div>
                                </div>
                            </div>
                            
                            <!-- Embedding Status -->
                            <div id="embedding-status" style="padding: 10px; background: #e3f2fd; border-radius: 8px; text-align: center; font-size: 13px; color: #1976d2;">
                                <span id="embedding-status-text">Laster...</span>
                            </div>
                        </div>
                        
                        <!-- Worker Status -->
                        <div id="worker-status" style="background: rgba(255,255,255,0.95); border-radius: 10px; padding: 15px; margin-bottom: 15px;">
                            <h4 style="margin: 0 0 10px 0; color: #009688;">ğŸ¤– Memory Worker</h4>
                            <div id="worker-status-content" style="font-size: 14px; color: #333;">
                                <p style="margin: 5px 0;">Laster...</p>
                            </div>
                        </div>
                        
                        <button class="btn-start" onclick="toggleMemoryView()" style="width: 100%; margin-bottom: 10px; padding: 15px; font-size: 16px; font-weight: bold; background: white; color: #00bcd4; border: none; border-radius: 10px; cursor: pointer; transition: all 0.3s;" onmouseover="this.style.background='#f0f0f0'" onmouseout="this.style.background='white'">
                            <span id="memory-toggle-text">ğŸ‘ï¸ Vis detaljert minne</span>
                        </button>
                        
                        <!-- Memory Settings -->
                        <div style="background: rgba(255,255,255,0.95); border-radius: 10px; padding: 15px; margin-bottom: 15px;">
                            <h4 style="margin: 0 0 15px 0; color: #00bcd4;">âš™ï¸ Minneinnstillinger</h4>
                            
                            <div style="margin-bottom: 20px;">
                                <h5 style="margin: 5px 0; font-size: 14px;">ğŸ§  Max Kontekst Fakta</h5>
                                <div style="display: flex; align-items: center; gap: 10px;">
                                    <span style="font-size: 12px;">1</span>
                                    <input type="range" id="max-facts-slider" min="1" max="200" value="100" 
                                           oninput="updateMaxFactsLabel()" onchange="changeMaxFacts()" 
                                           style="flex: 1;">
                                    <span style="font-size: 12px;">200</span>
                                </div>
                                <div style="text-align: center; margin-top: 5px;">
                                    <span id="max-facts-label" style="font-weight: bold; font-size: 13px;">100 fakta</span>
                                    <span id="max-facts-status" style="font-size: 12px;"></span>
                                </div>
                                <div style="font-size: 11px; color: #666; margin-top: 3px; text-align: center;">
                                    Totalt antall fakta i kontekst
                                </div>
                            </div>
                            
                            <div style="margin-bottom: 20px;">
                                <h5 style="margin: 5px 0; font-size: 14px;">ğŸ” Embedding SÃ¸k Limit</h5>
                                <div style="display: flex; align-items: center; gap: 10px;">
                                    <span style="font-size: 12px;">10</span>
                                    <input type="range" id="embedding-limit-slider" min="10" max="100" value="30" 
                                           oninput="updateEmbeddingLimitLabel()" onchange="changeEmbeddingLimit()" 
                                           style="flex: 1;">
                                    <span style="font-size: 12px;">100</span>
                                </div>
                                <div style="text-align: center; margin-top: 5px;">
                                    <span id="embedding-limit-value" style="font-weight: bold; font-size: 13px;">30</span> facts
                                    <span id="embedding-limit-status" style="font-size: 12px;"></span>
                                </div>
                                <div style="font-size: 11px; color: #666; margin-top: 3px; text-align: center;">
                                    Hvor mange facts embedding-sÃ¸k returnerer
                                </div>
                            </div>
                            
                            <div style="margin-bottom: 20px;">
                                <h5 style="margin: 5px 0; font-size: 14px;">ğŸ’­ Minnegrense</h5>
                                <div style="display: flex; align-items: center; gap: 10px;">
                                    <span style="font-size: 12px;">1</span>
                                    <input type="range" id="memory-limit-slider" min="1" max="20" value="8" 
                                           oninput="updateMemoryLimitLabel()" onchange="changeMemoryLimit()" 
                                           style="flex: 1;">
                                    <span style="font-size: 12px;">20</span>
                                </div>
                                <div style="text-align: center; margin-top: 5px;">
                                    <span id="memory-limit-value" style="font-weight: bold; font-size: 13px;">8</span> minner
                                    <span id="memory-limit-status" style="font-size: 12px;"></span>
                                </div>
                                <div style="font-size: 11px; color: #666; margin-top: 3px; text-align: center;">
                                    Antall episodiske minner i kontekst
                                </div>
                            </div>
                            
                            <div style="margin-bottom: 0;">
                                <h5 style="margin: 5px 0; font-size: 14px;">ğŸ¯ Minne Threshold</h5>
                                <div style="display: flex; align-items: center; gap: 10px;">
                                    <span style="font-size: 12px;">0.2</span>
                                    <input type="range" id="memory-threshold-slider" min="20" max="80" value="35" 
                                           oninput="updateMemoryThresholdLabel()" onchange="changeMemoryThreshold()" 
                                           style="flex: 1;">
                                    <span style="font-size: 12px;">0.8</span>
                                </div>
                                <div style="text-align: center; margin-top: 5px;">
                                    <span id="memory-threshold-value" style="font-weight: bold; font-size: 13px;">0.35</span>
                                    <span id="memory-threshold-status" style="font-size: 12px;"></span>
                                </div>
                                <div style="font-size: 11px; color: #666; margin-top: 3px; text-align: center;">
                                    Similarity threshold (lavere = mer inkluderende)
                                </div>
                            </div>
                        </div>
                        
                        <div id="memory-view" style="display: none; margin-top: 15px;">
                            <!-- Recent Updates Timeline -->
                            <div style="background: rgba(255,255,255,0.95); border-radius: 10px; padding: 15px; margin-bottom: 15px;">
                                <h4 style="margin: 0 0 10px 0; color: #ff9800;">ğŸ“… Siste Oppdateringer</h4>
                                <div id="recent-updates-list" style="font-size: 13px; max-height: 200px; overflow-y: auto;">
                                    Laster...
                                </div>
                            </div>
                            
                            <div style="background: rgba(255,255,255,0.95); border-radius: 10px; padding: 15px; margin-bottom: 15px;">
                                <h4 style="margin: 0 0 15px 0; color: #00bcd4;">ğŸ“‹ Profile Fakta</h4>
                                <input type="text" id="facts-search" placeholder="ğŸ” SÃ¸k i fakta..." style="width: 100%; padding: 10px; border: 2px solid #00bcd4; border-radius: 8px; margin-bottom: 10px; box-sizing: border-box;" oninput="filterFacts()">
                                
                                <!-- Category View Toggle -->
                                <div style="margin-bottom: 10px; text-align: center;">
                                    <button onclick="toggleFactsView()" id="facts-view-toggle" style="padding: 8px 16px; background: #00bcd4; color: white; border: none; border-radius: 6px; cursor: pointer; font-size: 13px;">
                                        ğŸ“ Vis etter kategori
                                    </button>
                                </div>
                                
                                <div id="memory-facts-list" style="max-height: 300px; overflow-y: auto; font-size: 14px;">
                                    Laster...
                                </div>
                            </div>
                            
                            <div style="background: rgba(255,255,255,0.95); border-radius: 10px; padding: 15px; margin-bottom: 15px;">
                                <h4 style="margin: 0 0 15px 0; color: #009688;">ğŸ’­ Episodiske Minner</h4>
                                <input type="text" id="memory-search" placeholder="ğŸ” SÃ¸k i minner..." style="width: 100%; padding: 10px; border: 2px solid #009688; border-radius: 8px; margin-bottom: 10px; box-sizing: border-box;" oninput="filterMemories()">
                                <div id="memory-memories-list" style="max-height: 300px; overflow-y: auto; font-size: 14px;">
                                    Laster...
                                </div>
                            </div>
                            
                            <div style="background: rgba(255,255,255,0.95); border-radius: 10px; padding: 15px;">
                                <h4 style="margin: 0 0 15px 0; color: #4caf50;">ğŸ“Š PopulÃ¦re Emner</h4>
                                <div id="memory-topics-list" style="font-size: 14px;">
                                    Laster...
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- System -->
        <div class="collapsible">
            <div class="collapsible-header" onclick="toggleCollapsible(this)">
                <span>âš™ï¸ System</span>
                <span class="arrow">â–¼</span>
            </div>
            <div class="collapsible-content">
                <div class="collapsible-body">
                    <div class="speak-section">
            <h3>ğŸŒ€ Viftekontroll</h3>
            <div style="display: flex; gap: 10px; margin-bottom: 15px;">
                <button class="btn" onclick="setFanMode('auto')" style="flex: 1;">ğŸ¤– Auto</button>
                <button class="btn" onclick="setFanMode('on')" style="flex: 1;">âœ… PÃ¥</button>
                <button class="btn" onclick="setFanMode('off')" style="flex: 1;">â¸ï¸ Av</button>
            </div>
            <div id="fan-status" style="text-align: center; padding: 15px; background: rgba(255,255,255,0.1); border-radius: 8px; font-weight: bold;">
                <div id="fan-mode">Modus: Laster...</div>
                <div id="fan-temp" style="font-size: 24px; margin: 10px 0;">ğŸŒ¡ï¸ --Â°C</div>
                <div id="fan-running">Status: Laster...</div>
            </div>
                    </div>
                    
                    <div class="speak-section">
                        <h3>ğŸ“Š Status og tester</h3>
                        <button class="btn" onclick="getStatus()">ğŸ” Sjekk status</button>
                        <button class="btn" onclick="testBeak()">ğŸ§ª Test nebbet</button>
                        <div id="test-result"></div>
                    </div>
                    
                    <div class="status-section">
                        <h3>ğŸŒ WiFi nettverk</h3>
                        <div id="wifi-list">Laster...</div>
                        <button class="btn" onclick="getWiFiNetworks()">ğŸ”„ Oppdater liste</button>
                    </div>
                </div>
            </div>
        </div>
        
    </div>
    
    <script>
        // Toggle collapsible sections
        function toggleCollapsible(header) {
            header.classList.toggle('active');
            const content = header.nextElementSibling;
            content.classList.toggle('active');
        }
        
        function updateVolumeValue() {
            const slider = document.getElementById('volume-slider');
            document.getElementById('volume-value').textContent = slider.value + '%';
        }

        function updateSpeedLabel() {
            const slider = document.getElementById('speed-slider');
            const label = document.getElementById('speed-label');
            const value = parseInt(slider.value);
            
            if (value < 25) {
                label.textContent = 'Veldig sakte ğŸŒ';
            } else if (value < 45) {
                label.textContent = 'Litt sakte';
            } else if (value < 55) {
                label.textContent = 'Normal hastighet';
            } else if (value < 75) {
                label.textContent = 'Litt raskere';
            } else {
                label.textContent = 'Rask ğŸ‡';
            }
        }

        async function changeSpeed() {
            const slider = document.getElementById('speed-slider');
            const statusElement = document.getElementById('speed-status');
            
            try {
                const response = await fetch('/change-speed', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ speed: slider.value })
                });
                const data = await response.json();
                
                if (data.success === true) {
                    statusElement.textContent = ' âœ“';
                    setTimeout(() => statusElement.textContent = '', 2000);
                } else {
                    statusElement.textContent = ' âœ— Feil';
                }
            } catch (error) {
                statusElement.textContent = ' âœ— Feil: ' + error.message;
            }
        }

        async function loadCurrentSpeed() {
            try {
                const response = await fetch('/current-speed');
                const data = await response.json();
                const slider = document.getElementById('speed-slider');
                slider.value = data.speed;
                updateSpeedLabel();
            } catch (error) {
                console.error('Kunne ikke laste talehastighet:', error);
            }
        }

        async function changeVolume() {
            const slider = document.getElementById('volume-slider');
            const statusElement = document.getElementById('volume-status');
            updateVolumeValue();
            
            try {
                const response = await fetch('/change-volume', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ volume: slider.value })
                });
                const data = await response.json();
                
                if (data.success === true) {
                    statusElement.textContent = ' âœ“';
                    setTimeout(() => statusElement.textContent = '', 2000);
                } else {
                    statusElement.textContent = ' âœ— Feil';
                }
            } catch (error) {
                statusElement.textContent = ' âœ— Feil: ' + error.message;
            }
        }

        async function loadCurrentVolume() {
            try {
                const response = await fetch('/current-volume');
                const data = await response.json();
                const slider = document.getElementById('volume-slider');
                slider.value = data.volume;
                updateVolumeValue();
            } catch (error) {
                console.error('Kunne ikke laste volum:', error);
            }
        }

        async function setFanMode(mode) {
            try {
                const response = await fetch('/set-fan-mode', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ mode: mode })
                });
                
                const data = await response.json();
                if (data.success) {
                    loadFanStatus();
                }
            } catch (error) {
                console.error('Kunne ikke endre viftemodus:', error);
            }
        }

        async function loadFanStatus() {
            try {
                const response = await fetch('/fan-status');
                const data = await response.json();
                
                const modeText = {
                    'auto': 'ğŸ¤– Automatisk',
                    'on': 'âœ… Alltid pÃ¥',
                    'off': 'â¸ï¸ Alltid av'
                };
                
                document.getElementById('fan-mode').textContent = 'Modus: ' + (modeText[data.mode] || data.mode);
                document.getElementById('fan-temp').innerHTML = `ğŸŒ¡ï¸ ${data.temp}Â°C`;
                
                const runningIcon = data.running ? 'ğŸŒ€' : 'â¸ï¸';
                const runningText = data.running ? 'Vifte gÃ¥r' : 'Vifte stÃ¥r';
                document.getElementById('fan-running').innerHTML = `${runningIcon} ${runningText}`;
                
                // Fargekoding av temperatur
                const tempElement = document.getElementById('fan-temp');
                if (data.temp >= 60) {
                    tempElement.style.color = '#ff4444';
                } else if (data.temp >= 55) {
                    tempElement.style.color = '#ffaa00';
                } else {
                    tempElement.style.color = '#44ff44';
                }
            } catch (error) {
                console.error('Kunne ikke laste viftestatus:', error);
            }
        }

        async function checkHAStatus() {
            try {
                const response = await fetch('/ha-status');
                const data = await response.json();
                
                const statusElement = document.getElementById('ha-status-text');
                const containerElement = document.getElementById('ha-status');
                
                if (data.available) {
                    statusElement.textContent = 'âœ… Tilkoblet';
                    statusElement.style.color = '#28a745';
                    containerElement.style.borderColor = '#28a745';
                    containerElement.style.background = '#d4edda';
                } else {
                    statusElement.textContent = `âŒ Ikke tilgjengelig (${data.error})`;
                    statusElement.style.color = '#dc3545';
                    containerElement.style.borderColor = '#dc3545';
                    containerElement.style.background = '#f8d7da';
                }
            } catch (error) {
                console.error('Kunne ikke sjekke HA-status:', error);
                const statusElement = document.getElementById('ha-status-text');
                statusElement.textContent = 'âš ï¸ Ukjent';
                statusElement.style.color = '#ffc107';
            }
        }
        
        // Sjekk HA-status ved oppstart og hver 30. sekund
        checkHAStatus();
        setInterval(checkHAStatus, 30000);
    </script>
    <script src="app.js"></script>
</body>
</html>
