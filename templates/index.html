<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ChatGPT Duck Control</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="container">
        <div class="duck-emoji">ğŸ¦†</div>
        <h1 id="duck-title">ChatGPT Duck</h1>
        
        <!-- ===== DASHBOARD ===== -->
        <div class="dashboard">
            <div id="status" class="status-box status-unknown">Henter status...</div>
            
            <div class="dashboard-grid">
                <div class="dash-card" id="current-user">
                    <span class="dash-label">ğŸ‘¤ Bruker</span>
                    <span class="dash-value" id="user-name">...</span>
                    <span class="dash-sub" id="user-relation"></span>
                </div>
                <div class="dash-card" id="ha-status">
                    <span class="dash-label">ğŸ  Home Assistant</span>
                    <span class="dash-value" id="ha-status-text">...</span>
                </div>
                <div class="dash-card" id="duck-location">
                    <span class="dash-label">ğŸ“ Lokasjon</span>
                    <span class="dash-value" id="duck-location-text">...</span>
                </div>
                <div class="dash-card" id="vision-status">
                    <span class="dash-label">ğŸ“· Duck-Vision</span>
                    <span class="dash-value" id="vision-status-text">...</span>
                </div>
                <div class="dash-card" id="system-stats">
                    <span class="dash-label">ğŸŒ¡ï¸ CPU</span>
                    <span class="dash-value" id="cpu-temp">...</span>
                </div>
                <div class="dash-card" id="system-stats-mem">
                    <span class="dash-label">ğŸ§  Minne</span>
                    <span class="dash-value" id="memory-available">...</span>
                </div>
            </div>
        </div>
        
        <!-- ===== TAMAGOTCHI ===== -->
        <div class="collapsible">
            <div class="collapsible-header" onclick="toggleCollapsible(this)">
                <span>ğŸ® Tamagotchi</span>
                <span class="arrow">â–¼</span>
            </div>
            <div class="collapsible-content">
                <div class="collapsible-body">
                    <!-- Hunger -->
                    <div class="meter-card meter-hunger" id="hunger-meter">
                        <div class="meter-title">ğŸ• Sultbarometer ğŸª</div>
                        <div class="meter-row">
                            <span class="meter-emoji" id="hunger-emoji">ğŸ˜Š</span>
                            <div class="meter-bar-wrap">
                                <div class="meter-bar-bg">
                                    <div class="meter-bar" id="hunger-bar"></div>
                                </div>
                                <div class="meter-info">
                                    <span id="hunger-level">0.0</span>/10 - <span id="hunger-status">Mett</span>
                                    <br><small>MÃ¥ltider i dag: <span id="meals-today">0</span> | Neste: <span id="next-meal">12:00</span></small>
                                </div>
                            </div>
                        </div>
                        <div class="feed-buttons">
                            <button class="btn-feed btn-cookie" onclick="feedAnda('cookie')">ğŸª Gi cookie</button>
                            <button class="btn-feed btn-pizza" onclick="feedAnda('pizza')">ğŸ• Gi pizza</button>
                        </div>
                        <div class="feed-result" id="feed-status"></div>
                    </div>
                    
                    <!-- Boredom -->
                    <div class="meter-card meter-boredom" id="boredom-meter">
                        <div class="meter-title">Kjedsomhetsbarometer</div>
                        <div class="meter-row">
                            <span class="meter-emoji" id="boredom-emoji">ğŸ˜Š</span>
                            <div class="meter-bar-wrap">
                                <div class="meter-bar-bg">
                                    <div class="meter-bar" id="boredom-bar"></div>
                                </div>
                                <div class="meter-info">
                                    <span id="boredom-level">0.0</span>/10 - <span id="boredom-status">FornÃ¸yd</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Sleep Mode -->
                    <div class="meter-card meter-sleep" id="sleep-mode-panel">
                        <div class="meter-title">ğŸ’¤ SÃ¸vnmodus</div>
                        <div class="sleep-status" id="sleep-mode-status">Aktiv</div>
                        <div class="sleep-controls">
                            <select id="sleep-duration" class="sleep-select">
                                <option value="30">30 minutter</option>
                                <option value="60" selected>1 time</option>
                                <option value="90">1.5 timer</option>
                                <option value="120">2 timer</option>
                                <option value="180">3 timer</option>
                                <option value="240">4 timer</option>
                            </select>
                            <button id="sleep-toggle-btn" class="btn-sleep" onclick="toggleSleepMode()">ğŸ’¤ Aktiver</button>
                        </div>
                        <div class="sleep-countdown" id="sleep-countdown" style="display:none;">
                            Sovner til: <strong id="sleep-end-time"></strong>
                            (<strong id="sleep-remaining"></strong> minutter igjen)
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- ===== SNAKK MED ANDA ===== -->
        <div class="collapsible">
            <div class="collapsible-header" onclick="toggleCollapsible(this)">
                <span>ğŸ’¬ Snakk med Anda</span>
                <span class="arrow">â–¼</span>
            </div>
            <div class="collapsible-content">
                <div class="collapsible-body">
                    <!-- Start conversation -->
                    <button class="btn-start" onclick="startConversation()" style="margin-bottom:15px;">ğŸ¤ Start samtale nÃ¥</button>
                    
                    <!-- Wake Words -->
                    <div id="wake-words-list" class="info" style="background:#e8f5e9; border-left-color:#4caf50; margin-bottom:20px;">
                        <p style="margin:0; color:#2e7d32;">Laster wake words...</p>
                    </div>
                    
                    <!-- Send message -->
                    <div class="message-card">
                        <h3>âœ‰ï¸ Send melding til Anda</h3>
                        <div class="form-group">
                            <label>Velg modus:</label>
                            <select id="message-mode">
                                <option value="speak">ğŸ”Š Bare si det (TTS)</option>
                                <option value="ai">ğŸ¤– Send til AI (ChatGPT)</option>
                            </select>
                        </div>
                        <textarea id="speak-text" rows="4" placeholder="Skriv din melding her..." class="message-textarea"></textarea>
                        <button class="btn-send-msg" onclick="sendMessage()">ğŸ“¤ Send melding</button>
                        <div id="ai-response" class="ai-response" style="display:none;">
                            <strong>ğŸ¤– AI Svar:</strong>
                            <div id="response-text"></div>
                        </div>
                    </div>
                    
                    <!-- Music -->
                    <div class="music-card">
                        <h3>ğŸµ La Anda synge!</h3>
                        <select id="song-select">
                            <option value="">Velg en sang...</option>
                        </select>
                        <div class="music-buttons">
                            <button class="btn-start" onclick="playSong()">ğŸ¤ Syng!</button>
                            <button class="btn-stop" onclick="stopSong()">â¹ Stopp</button>
                        </div>
                        <div id="song-status" class="song-result" style="display:none;"></div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- ===== SMS ===== -->
        <div class="collapsible">
            <div class="collapsible-header" onclick="toggleCollapsible(this)">
                <span>ğŸ“± SMS</span>
                <span class="arrow">â–¼</span>
            </div>
            <div class="collapsible-content">
                <div class="collapsible-body">
                    <div class="tab-bar">
                        <button class="tab-btn tab-active" onclick="switchSmsTab('history', this)">ğŸ“± Historikk</button>
                        <button class="tab-btn" onclick="switchSmsTab('contacts', this)">ğŸ“‡ Kontakter</button>
                    </div>
                    
                    <div id="sms-tab-history" class="tab-content tab-visible">
                        <div id="sms-history-container" style="max-height:600px; overflow:hidden;">
                            <div class="loading-text">Laster SMS...</div>
                        </div>
                    </div>
                    
                    <div id="sms-tab-contacts" class="tab-content">
                        <button class="btn-add-contact" onclick="showAddContactForm()">â• Legg til ny kontakt</button>
                        
                        <div id="add-contact-form" style="display:none;" class="contact-form">
                            <h4 id="contact-form-title">Ny kontakt</h4>
                            <input type="hidden" id="edit-contact-id" value="">
                            <input type="text" id="new-contact-name" placeholder="Navn">
                            <input type="tel" id="new-contact-phone" placeholder="Telefonnummer (+47...)">
                            <input type="text" id="new-contact-relation" placeholder="Relasjon (f.eks. venn, familie)">
                            <input type="number" id="new-contact-priority" placeholder="Prioritet (1-10)" min="1" max="10" value="5">
                            <div class="form-actions">
                                <button class="btn-save" onclick="saveContact()">Lagre</button>
                                <button class="btn-cancel" onclick="cancelAddContact()">Avbryt</button>
                            </div>
                        </div>
                        
                        <div id="contacts-list" class="contacts-grid">
                            <div class="loading-text">Laster kontakter...</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- ===== INNSTILLINGER ===== -->
        <div class="collapsible">
            <div class="collapsible-header" onclick="toggleCollapsible(this)">
                <span>ğŸ›ï¸ Innstillinger</span>
                <span class="arrow">â–¼</span>
            </div>
            <div class="collapsible-content">
                <div class="collapsible-body">
                    <div class="settings-group">
                        <h3 class="settings-group-title">ğŸ”Š Stemme & Lyd</h3>
                        
                        <div class="setting-row">
                            <label>ğŸ¤ Stemme</label>
                            <select id="voice-select" onchange="changeVoice()">
                                <option value="nb-NO-FinnNeural">Finn (Mann) ğŸ‘¨</option>
                                <option value="nb-NO-IselinNeural" selected>Iselin (Kvinne) ğŸ‘©</option>
                                <option value="nb-NO-PernilleNeural">Pernille (Kvinne) ğŸ‘©</option>
                            </select>
                            <span id="voice-status" class="status-indicator"></span>
                        </div>
                        
                        <div class="setting-row">
                            <label>ğŸšï¸ Hastighet</label>
                            <div class="slider-row">
                                <span class="slider-label-left">ğŸŒ</span>
                                <input type="range" id="speed-slider" min="0" max="100" value="50"
                                       oninput="updateSpeedLabel()" onchange="changeSpeed()">
                                <span class="slider-label-right">ğŸ‡</span>
                            </div>
                            <div class="slider-value" id="speed-label">Normal hastighet</div>
                            <span id="speed-status" class="status-indicator"></span>
                        </div>
                        
                        <div class="setting-row">
                            <label>ğŸ”Š Volum</label>
                            <div class="slider-row">
                                <span class="slider-label-left">ğŸ”‰</span>
                                <input type="range" id="volume-slider" min="0" max="100" value="50"
                                       oninput="updateVolumeValue()" onchange="changeVolume()">
                                <span class="slider-label-right">ğŸ”Š</span>
                            </div>
                            <div class="slider-value"><span id="volume-value">50%</span></div>
                            <span id="volume-status" class="status-indicator"></span>
                        </div>
                        
                        <div class="setting-row">
                            <label>ğŸ¦† Nebb</label>
                            <select id="beak-select" onchange="changeBeak()">
                                <option value="on">Nebbet beveger seg ğŸ‘„</option>
                                <option value="off">Nebbet av ğŸ”‡</option>
                            </select>
                            <span id="beak-status" class="status-indicator"></span>
                        </div>
                    </div>
                    
                    <div class="settings-group">
                        <h3 class="settings-group-title">ğŸ¤– AI & OppfÃ¸rsel</h3>
                        
                        <div class="setting-row">
                            <label>ğŸ§  AI Modell</label>
                            <select id="model-select" onchange="changeModel()">
                                <option value="gpt-4-turbo-2024-04-09">GPT-4.1 Mini â­</option>
                                <option value="gpt-4">GPT-4</option>
                                <option value="gpt-4-turbo">GPT-4.1 Turbo</option>
                                <option value="gpt-4o-mini">GPT-4o Mini</option>
                                <option value="gpt-3.5-turbo">GPT-3.5 Turbo</option>
                                <option value="gpt-5-turbo">GPT-5.2</option>
                            </select>
                            <span id="model-status" class="status-indicator"></span>
                        </div>
                        
                        <div class="setting-row">
                            <label>ğŸ­ Personlighet</label>
                            <select id="personality-select" onchange="changePersonality()">
                                <option value="normal">Normal ğŸ¦†</option>
                                <option value="frekk">Frekk & Sarkastisk ğŸ˜</option>
                                <option value="vennlig">Vennlig & Entusiastisk ğŸ˜Š</option>
                                <option value="akademisk">Akademisk & Detaljert ğŸ“</option>
                                <option value="filosof">Filosofisk & Reflekterende ğŸ¤”</option>
                                <option value="barnlig">Barnlig & Leken ğŸ‰</option>
                                <option value="senior">Senior & Sur ğŸ‘´</option>
                            </select>
                            <span id="personality-status" class="status-indicator"></span>
                        </div>
                        
                        <div class="setting-row">
                            <label>ğŸ¤ Wake Word Sensitivity</label>
                            <div class="slider-row">
                                <span class="slider-label-left">ğŸ”‡</span>
                                <input type="range" id="sensitivity-slider" min="0" max="100" value="90"
                                       oninput="updateSensitivityValue()" onchange="changeSensitivity()">
                                <span class="slider-label-right">ğŸ”Š</span>
                            </div>
                            <div class="slider-value"><span id="sensitivity-value">0.90</span></div>
                            <span id="sensitivity-status" class="status-indicator"></span>
                            <div class="setting-hint">âš ï¸ Krever restart av Anda</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- ===== PERSONLIGHET ===== -->
        <div class="collapsible">
            <div class="collapsible-header" onclick="toggleCollapsible(this)">
                <span>ğŸ­ Andas Personlighet</span>
                <span class="arrow">â–¼</span>
            </div>
            <div class="collapsible-content">
                <div class="collapsible-body">
                    <div class="personality-card">
                        <div class="personality-stats" id="personality-stats">
                            <span id="confidence-text">Confidence: --% | </span>
                            <span id="analyzed-text">Analysert: -- samtaler | </span>
                            <span id="last-analyzed-text">Sist: --</span>
                        </div>
                        
                        <div class="personality-sliders">
                            <div class="p-slider"><label>ğŸ’¬ Humor <span id="humor-value" class="p-val">5.0</span>/10</label><input type="range" id="humor-slider" min="0" max="10" step="0.5" value="5" oninput="updateSlider('humor', this.value)"><div class="p-hint">Lite humor â† â†’ Mye humor</div></div>
                            <div class="p-slider"><label>ğŸ“ Verbosity <span id="verbosity-value" class="p-val">5.0</span>/10</label><input type="range" id="verbosity-slider" min="0" max="10" step="0.5" value="5" oninput="updateSlider('verbosity', this.value)"><div class="p-hint">Korte svar â† â†’ Lange svar</div></div>
                            <div class="p-slider"><label>ğŸ‘” Formality <span id="formality-value" class="p-val">3.0</span>/10</label><input type="range" id="formality-slider" min="0" max="10" step="0.5" value="3" oninput="updateSlider('formality', this.value)"><div class="p-hint">Uformell â† â†’ Formell</div></div>
                            <div class="p-slider"><label>ğŸ‰ Enthusiasm <span id="enthusiasm-value" class="p-val">5.0</span>/10</label><input type="range" id="enthusiasm-slider" min="0" max="10" step="0.5" value="5" oninput="updateSlider('enthusiasm', this.value)"><div class="p-hint">Rolig â† â†’ Entusiastisk</div></div>
                            <div class="p-slider"><label>ğŸ”§ Technical <span id="technical-value" class="p-val">5.0</span>/10</label><input type="range" id="technical-slider" min="0" max="10" step="0.5" value="5" oninput="updateSlider('technical', this.value)"><div class="p-hint">Enkel â† â†’ Teknisk dyp</div></div>
                            <div class="p-slider"><label>â¤ï¸ Empathy <span id="empathy-value" class="p-val">5.0</span>/10</label><input type="range" id="empathy-slider" min="0" max="10" step="0.5" value="5" oninput="updateSlider('empathy', this.value)"><div class="p-hint">Kald/rasjonell â† â†’ Varm/forstÃ¥ende</div></div>
                            <div class="p-slider"><label>ğŸ¯ Directness <span id="directness-value" class="p-val">5.0</span>/10</label><input type="range" id="directness-slider" min="0" max="10" step="0.5" value="5" oninput="updateSlider('directness', this.value)"><div class="p-hint">Diplomatisk â† â†’ Direkte</div></div>
                            <div class="p-slider"><label>ğŸ§  Creativity <span id="creativity-value" class="p-val">5.0</span>/10</label><input type="range" id="creativity-slider" min="0" max="10" step="0.5" value="5" oninput="updateSlider('creativity', this.value)"><div class="p-hint">Faktabasert â† â†’ Kreativ</div></div>
                            <div class="p-slider"><label>ğŸ§­ Boundary <span id="boundary-value" class="p-val">5.0</span>/10</label><input type="range" id="boundary-slider" min="0" max="10" step="0.5" value="5" oninput="updateSlider('boundary', this.value)"><div class="p-hint">FÃ¸lger ordre â† â†’ Utfordrer</div></div>
                            <div class="p-slider"><label>ğŸš€ Proactivity <span id="proactivity-value" class="p-val">5.0</span>/10</label><input type="range" id="proactivity-slider" min="0" max="10" step="0.5" value="5" oninput="updateSlider('proactivity', this.value)"><div class="p-hint">Bare svarer â† â†’ ForeslÃ¥r aktivt</div></div>
                        </div>
                        
                        <button class="btn-save-personality" onclick="savePersonality()">ğŸ’¾ Lagre Personlighet</button>
                        <div id="personality-save-status" class="save-status" style="display:none;"></div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- ===== MINNE ===== -->
        <div class="collapsible">
            <div class="collapsible-header" onclick="toggleCollapsible(this)">
                <span>ğŸ§  Andas Minne</span>
                <span class="arrow">â–¼</span>
            </div>
            <div class="collapsible-content">
                <div class="collapsible-body">
                    <div class="memory-card">
                        <div class="memory-section" id="quick-facts">
                            <h4>âš¡ NÃ¸kkelfakta</h4>
                            <div id="quick-facts-content"><p>Laster...</p></div>
                        </div>
                        
                        <div class="memory-stats-grid">
                            <div class="memory-stat">
                                <div class="stat-number" id="memory-stats-facts">-</div>
                                <div class="stat-label">Fakta</div>
                            </div>
                            <div class="memory-stat">
                                <div class="stat-number stat-teal" id="memory-stats-memories">-</div>
                                <div class="stat-label">Minner</div>
                            </div>
                            <div class="memory-stat">
                                <div class="stat-number stat-green" id="memory-stats-messages">-</div>
                                <div class="stat-label">Meldinger</div>
                            </div>
                        </div>
                        
                        <div class="embedding-status" id="embedding-status">
                            <span id="embedding-status-text">Laster...</span>
                        </div>
                        
                        <div class="memory-section" id="worker-status">
                            <h4>ğŸ¤– Memory Worker</h4>
                            <div id="worker-status-content"><p>Laster...</p></div>
                        </div>
                        
                        <details class="memory-settings">
                            <summary>âš™ï¸ Minneinnstillinger</summary>
                            <div class="memory-settings-body">
                                <div class="mem-setting">
                                    <label>ğŸ§  Max Kontekst Fakta</label>
                                    <div class="slider-row"><span class="slider-label-left">1</span><input type="range" id="max-facts-slider" min="1" max="200" value="100" oninput="updateMaxFactsLabel()" onchange="changeMaxFacts()"><span class="slider-label-right">200</span></div>
                                    <div class="slider-value"><span id="max-facts-label">100 fakta</span> <span id="max-facts-status"></span></div>
                                </div>
                                <div class="mem-setting">
                                    <label>ğŸ” Embedding SÃ¸k Limit</label>
                                    <div class="slider-row"><span class="slider-label-left">10</span><input type="range" id="embedding-limit-slider" min="10" max="100" value="30" oninput="updateEmbeddingLimitLabel()" onchange="changeEmbeddingLimit()"><span class="slider-label-right">100</span></div>
                                    <div class="slider-value"><span id="embedding-limit-value">30</span> facts <span id="embedding-limit-status"></span></div>
                                </div>
                                <div class="mem-setting">
                                    <label>ğŸ’­ Minnegrense</label>
                                    <div class="slider-row"><span class="slider-label-left">1</span><input type="range" id="memory-limit-slider" min="1" max="20" value="8" oninput="updateMemoryLimitLabel()" onchange="changeMemoryLimit()"><span class="slider-label-right">20</span></div>
                                    <div class="slider-value"><span id="memory-limit-value">8</span> minner <span id="memory-limit-status"></span></div>
                                </div>
                                <div class="mem-setting">
                                    <label>ğŸ¯ Minne Threshold</label>
                                    <div class="slider-row"><span class="slider-label-left">0.2</span><input type="range" id="memory-threshold-slider" min="20" max="80" value="35" oninput="updateMemoryThresholdLabel()" onchange="changeMemoryThreshold()"><span class="slider-label-right">0.8</span></div>
                                    <div class="slider-value"><span id="memory-threshold-value">0.35</span> <span id="memory-threshold-status"></span></div>
                                </div>
                            </div>
                        </details>
                        
                        <details class="memory-settings" id="memory-details">
                            <summary>ğŸ‘ï¸ Detaljert minne</summary>
                            <div id="memory-view">
                            <div class="memory-section">
                                <h4>ğŸ“… Siste Oppdateringer</h4>
                                <div id="recent-updates-list" class="scroll-list">Laster...</div>
                            </div>
                            <div class="memory-section">
                                <h4>ğŸ“‹ Profile Fakta</h4>
                                <input type="text" id="facts-search" placeholder="ğŸ” SÃ¸k i fakta..." oninput="filterFacts()" class="search-input">
                                <div class="view-toggle-row"><button onclick="toggleFactsView()" id="facts-view-toggle" class="btn-small">ğŸ“ Vis etter kategori</button></div>
                                <div id="memory-facts-list" class="scroll-list">Laster...</div>
                            </div>
                            <div class="memory-section">
                                <h4>ğŸ’­ Episodiske Minner</h4>
                                <input type="text" id="memory-search" placeholder="ğŸ” SÃ¸k i minner..." oninput="filterMemories()" class="search-input">
                                <div id="memory-memories-list" class="scroll-list">Laster...</div>
                            </div>
                            <div class="memory-section">
                                <h4>ğŸ“Š PopulÃ¦re Emner</h4>
                                <div id="memory-topics-list">Laster...</div>
                            </div>
                        </details>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- ===== SYSTEM ===== -->
        <div class="collapsible">
            <div class="collapsible-header" onclick="toggleCollapsible(this)">
                <span>âš™ï¸ System</span>
                <span class="arrow">â–¼</span>
            </div>
            <div class="collapsible-content">
                <div class="collapsible-body">
                    <!-- Service Control -->
                    <div class="settings-group">
                        <h3 class="settings-group-title">ğŸ¦† Tjenestekontroll</h3>
                        <div class="btn-grid-3">
                            <button class="btn-start" onclick="controlDuck('start')">â–¶ï¸ Start</button>
                            <button class="btn-stop" onclick="controlDuck('stop')">â¹ï¸ Stopp</button>
                            <button class="btn-restart" onclick="controlDuck('restart')">ğŸ”„ Restart</button>
                        </div>
                        <div class="btn-grid-2" style="margin-top:8px;">
                            <button class="btn-user" onclick="toggleUserPanel()">ğŸ‘¥ Bytt Bruker</button>
                            <button class="btn-logs" onclick="toggleLogs()">ğŸ“‹ Vis Logger</button>
                        </div>
                    </div>
                    
                    <!-- User Management Panel -->
                    <div id="user-panel" class="user-panel" style="display:none;">
                        <h3>ğŸ‘¥ Brukeradministrasjon</h3>
                        <div class="form-group">
                            <label>Bytt til eksisterende bruker:</label>
                            <select id="user-select"><option value="">Laster brukere...</option></select>
                            <button class="btn-switch-user" onclick="switchToUser()">ğŸ”„ Bytt bruker</button>
                        </div>
                        <div class="user-list-section">
                            <h4>ğŸ“‹ Registrerte brukere:</h4>
                            <div id="users-list" class="scroll-list-sm">Laster brukere...</div>
                        </div>
                    </div>
                    
                    <!-- Log Output -->
                    <div id="log-output" class="log-output" style="display:none;">
                        <div id="log-content" class="log-content">Laster logger...</div>
                    </div>
                    
                    <!-- 3D Printer -->
                    <div class="settings-group">
                        <h3 class="settings-group-title">ğŸ–¨ï¸ 3D Printer</h3>
                        <div id="printer-panel" class="printer-panel">
                            <div id="printer-status-container">
                                <div id="printer-loading" class="loading-text"><span style="font-size:1.5em;">â³</span><br>Henter status...</div>
                                <div id="printer-status" style="display:none;">
                                    <div class="printer-emoji-row"><span id="printer-emoji">ğŸ–¨ï¸</span></div>
                                    <div class="printer-state"><span id="printer-state-text">IDLE</span></div>
                                    <div id="printer-progress-container" style="display:none;">
                                        <div class="printer-job"><span id="printer-job-name">job.gcode</span></div>
                                        <div class="meter-bar-bg" style="height:24px; margin:8px 0;">
                                            <div id="printer-progress-bar" class="printer-progress-fill"><span id="printer-progress-text" class="printer-progress-label"></span></div>
                                        </div>
                                        <div class="printer-time">â±ï¸ <span id="printer-time-remaining">...</span></div>
                                    </div>
                                    <div id="printer-temps" class="printer-temps">
                                        <span>ğŸŒ¡ï¸ Nozzle: <strong id="printer-temp-nozzle">0</strong>Â°C</span>
                                        <span>ğŸ›ï¸ Bed: <strong id="printer-temp-bed">0</strong>Â°C</span>
                                    </div>
                                    <div id="printer-message" class="printer-message"></div>
                                </div>
                                <div id="printer-error" style="display:none; color:#d32f2f;">âŒ <span id="printer-error-text"></span></div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Fan Control -->
                    <div class="settings-group">
                        <h3 class="settings-group-title">ğŸŒ€ Viftekontroll</h3>
                        <div class="btn-grid-3">
                            <button class="btn" onclick="setFanMode('auto')">ğŸ¤– Auto</button>
                            <button class="btn" onclick="setFanMode('on')">âœ… PÃ¥</button>
                            <button class="btn" onclick="setFanMode('off')">â¸ï¸ Av</button>
                        </div>
                        <div id="fan-status" class="fan-status">
                            <div id="fan-mode">Modus: Laster...</div>
                            <div id="fan-temp" class="fan-temp">ğŸŒ¡ï¸ --Â°C</div>
                            <div id="fan-running">Status: Laster...</div>
                        </div>
                    </div>
                    
                    <!-- Backup -->
                    <div class="settings-group">
                        <h3 class="settings-group-title">ğŸ’¾ Backup</h3>
                        <button class="btn-backup" onclick="createBackup()" style="margin-bottom:10px;">ğŸ’¾ Ta Backup</button>
                        <div id="backup-status" class="backup-info">
                            <div class="backup-label">Siste backup:</div>
                            <div id="latest-backup" class="backup-value">Laster...</div>
                        </div>
                        <div id="backup-list" class="scroll-list-sm">Laster backups...</div>
                    </div>
                    
                    <!-- WiFi -->
                    <div class="settings-group">
                        <h3 class="settings-group-title">ğŸŒ WiFi & Nettverk</h3>
                        <button class="btn-wifi" onclick="switchToHotspot()" style="margin-bottom:10px;">ğŸ“¡ Bytt WiFi-nettverk</button>
                        <div id="wifi-list" class="wifi-list">Laster...</div>
                        <button class="btn" onclick="getWiFiNetworks()" style="margin-top:8px;">ğŸ”„ Oppdater</button>
                    </div>
                    
                    <!-- Test -->
                    <div class="settings-group">
                        <h3 class="settings-group-title">ğŸ”§ Test & Status</h3>
                        <div class="btn-grid-2">
                            <button class="btn" onclick="getStatus()">ğŸ” Sjekk status</button>
                            <button class="btn" onclick="testBeak()">ğŸ§ª Test nebbet</button>
                        </div>
                        <div id="test-result"></div>
                    </div>
                    
                    <!-- Danger Zone -->
                    <div class="danger-zone">
                        <h3 class="settings-group-title" style="color:#d32f2f;">âš ï¸ StrÃ¸mstyring</h3>
                        <div class="btn-grid-2">
                            <button class="btn-reboot" onclick="rebootPi()">ğŸ”„ Restart Pi</button>
                            <button class="btn-shutdown" onclick="shutdownPi()">ğŸ”Œ Skru av Pi</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
    </div>
    
    <script>
        function toggleCollapsible(header) {
            header.classList.toggle('active');
            header.nextElementSibling.classList.toggle('active');
        }
        
        function switchSmsTab(tab, btn) {
            document.querySelectorAll('.tab-content').forEach(el => el.classList.remove('tab-visible'));
            document.querySelectorAll('.tab-btn').forEach(el => el.classList.remove('tab-active'));
            document.getElementById('sms-tab-' + tab).classList.add('tab-visible');
            btn.classList.add('tab-active');
        }
        
        function updateVolumeValue() {
            document.getElementById('volume-value').textContent = document.getElementById('volume-slider').value + '%';
        }

        function updateSpeedLabel() {
            const v = parseInt(document.getElementById('speed-slider').value);
            const l = document.getElementById('speed-label');
            l.textContent = v < 25 ? 'Veldig sakte ğŸŒ' : v < 45 ? 'Litt sakte' : v < 55 ? 'Normal hastighet' : v < 75 ? 'Litt raskere' : 'Rask ğŸ‡';
        }

        async function changeSpeed() {
            const s = document.getElementById('speed-status');
            try {
                const r = await fetch('/change-speed', {method:'POST', headers:{'Content-Type':'application/json'}, body:JSON.stringify({speed:document.getElementById('speed-slider').value})});
                const d = await r.json();
                if(d.success){s.textContent=' âœ“';setTimeout(()=>s.textContent='',2000);}else s.textContent=' âœ—';
            }catch(e){s.textContent=' âœ—';}
        }

        async function loadCurrentSpeed() {
            try{const r=await fetch('/current-speed');const d=await r.json();document.getElementById('speed-slider').value=d.speed;updateSpeedLabel();}catch(e){}
        }

        async function changeVolume() {
            const s = document.getElementById('volume-status');
            updateVolumeValue();
            try {
                const r = await fetch('/change-volume', {method:'POST', headers:{'Content-Type':'application/json'}, body:JSON.stringify({volume:document.getElementById('volume-slider').value})});
                const d = await r.json();
                if(d.success){s.textContent=' âœ“';setTimeout(()=>s.textContent='',2000);}else s.textContent=' âœ—';
            }catch(e){s.textContent=' âœ—';}
        }

        async function loadCurrentVolume() {
            try{const r=await fetch('/current-volume');const d=await r.json();document.getElementById('volume-slider').value=d.volume;updateVolumeValue();}catch(e){}
        }

        function updateSensitivityValue() {
            document.getElementById('sensitivity-value').textContent = (parseInt(document.getElementById('sensitivity-slider').value)/100).toFixed(2);
        }

        async function changeSensitivity() {
            const sensitivity = parseInt(document.getElementById('sensitivity-slider').value)/100;
            const s = document.getElementById('sensitivity-status');
            updateSensitivityValue();
            try{const r=await fetch('/api/wake-word/sensitivity',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({sensitivity})});const d=await r.json();if(d.status==='success'){s.textContent=' âœ“';setTimeout(()=>s.textContent='',2000);}else s.textContent=' âœ—';}catch(e){s.textContent=' âœ—';}
        }

        async function loadSensitivity() {
            try{const r=await fetch('/api/wake-word/sensitivity');const d=await r.json();document.getElementById('sensitivity-slider').value=Math.round(d.sensitivity*100);updateSensitivityValue();}catch(e){}
        }

        async function setFanMode(mode) {
            try{const r=await fetch('/set-fan-mode',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({mode})});const d=await r.json();if(d.success)loadFanStatus();}catch(e){}
        }

        async function loadFanStatus() {
            try {
                const r = await fetch('/fan-status'); const d = await r.json();
                const mt={'auto':'ğŸ¤– Automatisk','on':'âœ… Alltid pÃ¥','off':'â¸ï¸ Alltid av'};
                document.getElementById('fan-mode').textContent='Modus: '+(mt[d.mode]||d.mode);
                document.getElementById('fan-temp').innerHTML=`ğŸŒ¡ï¸ ${d.temp}Â°C`;
                document.getElementById('fan-running').innerHTML=`${d.running?'ğŸŒ€ Vifte gÃ¥r':'â¸ï¸ Vifte stÃ¥r'}`;
                const t=document.getElementById('fan-temp');
                t.style.color=d.temp>=60?'#ff4444':d.temp>=55?'#ffaa00':'#44ff44';
            } catch(e) {}
        }

        async function checkHAStatus() {
            try {
                const r = await fetch('/ha-status'); const d = await r.json();
                const el = document.getElementById('ha-status-text');
                const card = document.getElementById('ha-status');
                if(d.available){el.textContent='âœ… Tilkoblet';el.style.color='#28a745';card.style.borderColor='#28a745';card.style.background='#d4edda';}
                else{el.textContent='âŒ Feil';el.style.color='#dc3545';card.style.borderColor='#dc3545';card.style.background='#f8d7da';}
            } catch(e){document.getElementById('ha-status-text').textContent='âš ï¸ Ukjent';}
        }
        
        function updateSlider(dim,val){document.getElementById(dim+'-value').textContent=parseFloat(val).toFixed(1);}

        async function loadPersonality() {
            try {
                const r=await fetch('/api/personality');const d=await r.json();
                ['humor','verbosity','formality','enthusiasm','technical','empathy','directness','creativity','boundary','proactivity'].forEach(dim=>{
                    const v=d[dim+'_level']||5.0;document.getElementById(dim+'-slider').value=v;document.getElementById(dim+'-value').textContent=v.toFixed(1);
                });
                document.getElementById('confidence-text').textContent=`Confidence: ${(d.confidence_score||0).toFixed(0)}% | `;
                document.getElementById('analyzed-text').textContent=`Analysert: ${d.conversations_analyzed||0} samtaler | `;
                document.getElementById('last-analyzed-text').textContent=`Sist: ${d.last_analyzed||'--'}`;
            } catch(e){}
        }

        async function savePersonality() {
            const s=document.getElementById('personality-save-status');s.style.display='block';s.style.background='#fff3cd';s.style.color='#333';s.textContent='â³ Lagrer...';
            try {
                const data={
                    humor_level:parseFloat(document.getElementById('humor-slider').value),
                    verbosity_level:parseFloat(document.getElementById('verbosity-slider').value),
                    formality_level:parseFloat(document.getElementById('formality-slider').value),
                    enthusiasm_level:parseFloat(document.getElementById('enthusiasm-slider').value),
                    technical_depth:parseFloat(document.getElementById('technical-slider').value),
                    empathy_level:parseFloat(document.getElementById('empathy-slider').value),
                    directness_level:parseFloat(document.getElementById('directness-slider').value),
                    creativity_level:parseFloat(document.getElementById('creativity-slider').value),
                    boundary_level:parseFloat(document.getElementById('boundary-slider').value),
                    proactivity_level:parseFloat(document.getElementById('proactivity-slider').value)
                };
                const r=await fetch('/api/personality/update',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify(data)});
                const result=await r.json();
                if(result.success){s.style.background='#d4edda';s.style.color='#155724';s.textContent='âœ“ '+(result.message||'Oppdatert!');setTimeout(()=>s.style.display='none',3000);}
                else{s.style.background='#f8d7da';s.style.color='#721c24';s.textContent='âœ— '+(result.message||'Feil');}
            }catch(e){s.style.background='#f8d7da';s.style.color='#721c24';s.textContent='âœ— '+e.message;}
        }

        window.addEventListener('load',()=>{loadPersonality();loadSensitivity();});
        checkHAStatus();
        setInterval(checkHAStatus,30000);
    </script>
    <script src="app.js"></script>
</body>
</html>
